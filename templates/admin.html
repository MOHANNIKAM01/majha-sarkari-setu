{% extends "base.html" %}
{% block title %} â€¢ Admin Dashboard{% endblock %}
{% block content %}

<div class="pagehead">
  <h1>Admin Dashboard</h1>
  <p class="muted">Add posts â€¢ Manage content â€¢ Filters</p>
</div>

<!-- ================= FILTERS ================= -->
<div class="card" style="margin-bottom:16px;">
  <form method="get"
        action="{{ url_for('admin_dashboard') }}"
        class="form form--inline"
        style="gap:12px;align-items:end;">

    <div>
      <label class="muted">Category</label>
      <select name="category">
        <option value="">All</option>
        {% for c in cats %}
          <option value="{{ c['slug'] }}"
            {% if request.args.get('category') == c['slug'] %}selected{% endif %}>
            {{ c['name'] }}
          </option>
        {% endfor %}
      </select>
    </div>

    <div>
      <label class="muted">Status</label>
      <select name="status">
        <option value="">All</option>
        <option value="published"
          {% if request.args.get('status') == 'published' %}selected{% endif %}>
          Published
        </option>
        <option value="draft"
          {% if request.args.get('status') == 'draft' %}selected{% endif %}>
          Draft
        </option>
      </select>
    </div>

    <button class="btn btn--ghost" type="submit">Apply</button>
    <a class="btn btn--ghost" href="{{ url_for('admin_dashboard') }}">Reset</a>

    <a class="btn" href="{{ url_for('admin_messages') }}" style="margin-left:auto;">
      ðŸ“© Messages
    </a>
  </form>
</div>

<!-- ================= MAIN GRID ================= -->
<div class="admingrid">

  <!-- ===== ADD POST ===== -->
  <section class="card">
    <div class="section__head">
      <h2>Add New Post</h2>
    </div>

    <form method="post" action="{{ url_for('admin_add_post') }}" class="form">
      <label>Title</label>
      <input name="title" required placeholder="Police Bharti 2026 â€“ Apply Online">

      <label>Category</label>
      <select name="category_slug" required>
        {% for c in cats %}
          <option value="{{ c['slug'] }}">{{ c['name'] }}</option>
        {% endfor %}
      </select>

      <label>Summary (short)</label>
      <input name="summary" required placeholder="One line important summary">

      <label>Content (full details)</label>
      <textarea name="content" rows="8" required
        placeholder="Eligibility, Age limit, Dates, How to apply..."></textarea>

      <label>Official Website (optional)</label>
      <input name="source_url" placeholder="https://official-website.gov.in">

      <button class="btn" type="submit">Publish</button>
    </form>
  </section>

  <!-- ===== POSTS LIST ===== -->
  <section class="card">
    <div class="section__head">
      <h2>Posts</h2>
      <span class="muted">Latest first</span>
    </div>

    <div class="tablewrap">
      <table class="table">
        <thead>
          <tr>
            <th>Title</th>
            <th>Category</th>
            <th>Date</th>
            <th>Status</th>
            <th style="width:170px;">Action</th>
          </tr>
        </thead>
        <tbody>
          {% for p in posts %}
          <tr>
            <td>
              <a class="link"
                 href="{{ url_for('post', post_id=p['id']) }}"
                 target="_blank">
                 {{ p['title'] }}
              </a>
            </td>

            <td>
              <span class="pill pill--{{ p['category_slug'] }}">
                {{ p['category_slug'] }}
              </span>
            </td>

            <td class="muted">{{ p['created_at'] }}</td>

            <td>
              {% if p['is_published'] == 1 %}
                <span class="status status--ok">Published</span>
              {% else %}
                <span class="status status--off">Draft</span>
              {% endif %}
            </td>

            <td>
              <a class="btn btn--sm btn--ghost"
                 href="{{ url_for('admin_edit_post', post_id=p['id']) }}">
                 Edit
              </a>

              <form method="post"
                    action="{{ url_for('admin_delete_post', post_id=p['id']) }}"
                    style="display:inline"
                    onsubmit="return confirm('Are you sure?');">
                <button class="btn btn--sm btn--danger" type="submit">
                  Delete
                </button>
              </form>
            </td>
          </tr>
          {% else %}
          <tr>
            <td colspan="5" class="muted">No posts found.</td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>

    <hr class="hr">

    <!-- ===== ADD CATEGORY ===== -->
    <div class="section__head">
      <h2>Add Category</h2>
    </div>

    <form method="post"
          action="{{ url_for('admin_add_category') }}"
          class="form form--inline">
      <input name="name" placeholder="Category Name" required>
      <input name="slug" placeholder="slug (small letters)" required>
      <button class="btn btn--ghost" type="submit">Add</button>
    </form>

    <p class="muted" style="margin-top:8px;">
      Tip: slug = lowercase, no spaces (example: <b>admitcard</b>)
    </p>
  </section>

</div>

{% endblock %}
